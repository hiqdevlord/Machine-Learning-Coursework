function [cm,avg_error]=evaluation(examples,targets,whichnet)
%%whichnet=0 : One Multi Output Network
%%whichnet=1 : Six Single Output Networks
N=10; %N-Cross Validation
c=1;sum=0;
[examples_no, ~]=size(examples);
actual=[];
predicted=[];

%The examples matrix is split test_data and train_data which correspond to
%the 10% and 90% accordingly.
currentFold=0;
for i=1:examples_no/N:examples_no
    currentFold=currentFold+1;
    %Compute test data (10 rows)
    test_data=examples(i:i+N-1,:);
    test_targets=targets(i:i+N-1);
    %Compute train data (90 rows)
    train_data=examples;
    train_data(i:i+N-1,:)=[];
    %Compute train target (90 rows)
    train_target=targets;
    train_target(i:i+N-1)=[];
    
    %Retrieve the nets for every emotion
    [P,T]=ANNdata(train_data,train_target);
    
    if whichnet==0
        net=getMultiOutputNet(P,T);
        y=testANN(net,test_data',whichnet);
    else
        nets=getSingleOutputNets(P,T);
        %Returns the vector containing all the predicted values for the
        %specific test data
        test_data'
        y=testANN(nets,test_data,whichnet);
    end

    %For every value that is not classified and therefore it returns zero
    %we set it to the value that appears the most in this specific vector.
    y(y==0)=mode(test_targets);
    
    %Create an overall predicted labels vector by concatenating with each y
    %vector returned.
    predicted=[predicted y'];
    %Create an overall actual labels vector by concatenating with each test
    %target vectory
    actual=[actual test_targets'];
    
    %Calculate this fold's confusion matrix, precision and recall
    %in order to display the performance per fold figure.
    cm_per_fold=conf_matrix(test_targets', y');
    [pr,rc]=precision_recall(cm_per_fold);
    f=fa_measure(1,pr,rc);
    fmean(currentFold)=mean(f);
    
    %Estimate the error for the current subset by comparing it with the
    %actual label vector
    e(c)=0;
    for j=1:N
        if y(j)~=test_targets(j)
            e(c)=e(c)+1;
        end
    end
    e(c)=e(c)/N;
    
    %Sum up all the 10 errors in order to compute the avg error later
    sum=sum+e(c);
    c=c+1;
end

%Display performance(F1Measure) per fold figure
figure;
x=[1:10];
plot(x,fmean,'LineWidth',2,'LineStyle','-');
%legend('1-fold','2-fold','3-fold','4-fold','5-fold','6-fold','7-fold','8-fold','9-fold','10-fold');
%Compute the total error and the confusion matrix
avg_error=(1/N)*sum;
cm=conf_matrix(actual, predicted);
%[pr,rc]=precision_recall(cm);
%[f]=fa_measure(1,pr,rc)


end
    